# 需求分析

## 问题陈述
目标是一个文件收集系统，可用于收作业等。传统的FTP方式只能匿名收集，而且每个上传者无法修改自己上传的那个文件。以前我们采取的方法是在文件名末尾添加版本号。我们希望，每个上传者可以修改自己上传的文件，但不能修改别人上传的文件

本系统以网站形式呈现，开放源代码，并提供docker image，方便用户自行部署。这样可以确保用户隐私，并且不必支付服务费用。前后端应当分离，方便二次开发

## 名词术语表
游客：未登录的用户

已登录用户分为三种角色：uploader, collector, admin。权限依次增大，后者包含前者的功能

文件包含以下公开属性（名称+所在目录ID唯一确定）：
- 名称
- 所在目录ID
- 上传者ID
- 哈希值（便于用户确认服务端文件是否正确）
- 最后修改时间

文件夹包含以下公开属性（名称+创建者ID唯一确定）：
- 名称
- 创建者ID
- 过期时间（只对uploader生效）
- 上传约束（文件大小、文件名格式（正则）、每人最多上传数量）

uploader和文件夹之间存在可见关系，一个uploader可以可见多个文件夹，一个文件夹可以被多个uploader可见

## 用例

游客
- 登录

以下所有操作均包含前置条件：用户已登录

uploader
- 获取可见的文件夹的列表
- 查看某一可见文件夹里面自己上传过的文件
  - 事件流
    - 选择某个可见文件夹
    - 系统显示文件夹内该用户上传的文件的列表，包含每个文件的属性
- 向某一文件夹添加新文件
- 覆盖或删除某一可见文件夹内自己上传过的文件
- 设置时区，所有时间将按照指定时区显示
- 设置语言，界面将按照指定语言展示（若无该语言的人工版本，将提示并提供机器翻译的版本）
- 修改自己的密码

collector
- 创建新文件夹
- 设置自己创建的某个文件夹对哪些uploader可见
- 设置文件夹过期时间
- 查看文件夹内的全部文件及其属性
- 单个或批量下载文件夹内的文件
- 单个或批量下载文件夹
- 设置文件夹上传约束

admin
- 创建用户账号
  - 事件流
    - 输入新用户的用户名和初始密码
    - 提交输入
    - 系统检查用户名是否重复
      - 重复：系统拒绝操作，并提示
      - 不重复：系统保存新用户的信息，并提示
  - 后置条件
    - 成功：新用户数据被创建、记录日志
    - 失败：记录日志
- 查看用户列表
- 修改用户密码
  - 事件流
    - 在用户列表中选中一个用户
    - 请求修改密码
    - 输入该用户的新密码
    - 提交新密码
    - 服务器记录指定用户的新密码
  - 后置条件
    - 成功：指定用户的密码被修改，并记录日志（指定用户ID、admin ID、时间）
    - 失败：记录日志
- 删除用户

## 补充规约

- 大量用户同时上传时，单个用户的上传速度仍然不受影响
- admin无法查看用户密码。即使数据库泄露，密码仍然是安全的